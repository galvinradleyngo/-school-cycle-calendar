<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Cycle Calendar</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { ChevronLeft, ChevronRight, Calendar, ChevronUp, ChevronDown, CheckCircle } = lucideReact;

        const SlotMachineModal = ({ value, onChange, onClose, isVisible }) => {
          const [selectedValue, setSelectedValue] = useState(value);
          const options = [0, 1, 2, 3, 4, 5, 6, 7];

          useEffect(() => {
            setSelectedValue(value);
          }, [value]);

          const handleScroll = (direction) => {
            const currentIndex = options.indexOf(selectedValue);
            let newIndex;
            
            if (direction === 'up') {
              newIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;
            } else {
              newIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;
            }
            
            setSelectedValue(options[newIndex]);
          };

          const handleSelect = () => {
            onChange(selectedValue);
            onClose();
          };

          useEffect(() => {
            const handleKeyDown = (e) => {
              if (e.key === 'ArrowUp') {
                e.preventDefault();
                handleScroll('up');
              } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                handleScroll('down');
              } else if (e.key === 'Enter') {
                e.preventDefault();
                handleSelect();
              } else if (e.key === 'Escape') {
                onClose();
              }
            };

            if (isVisible) {
              document.addEventListener('keydown', handleKeyDown);
              return () => document.removeEventListener('keydown', handleKeyDown);
            }
          }, [selectedValue, isVisible]);

          if (!isVisible) return null;

          return React.createElement('div', {
            className: "fixed inset-0 z-50 flex items-center justify-center"
          },
            React.createElement('div', {
              className: "absolute inset-0 bg-black bg-opacity-50 transition-opacity duration-300",
              onClick: onClose
            }),
            React.createElement('div', {
              className: `relative bg-white border-2 border-blue-300 rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-300 ease-out ${
                isVisible ? 'scale-100 opacity-100' : 'scale-75 opacity-0'
              }`
            },
              React.createElement('div', {
                className: "bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 text-center"
              },
                React.createElement('div', {
                  className: "text-lg font-bold"
                }, "Select Cycle Day")
              ),
              React.createElement('div', {
                className: "flex flex-col items-center p-6"
              },
                React.createElement('button', {
                  onClick: () => handleScroll('up'),
                  className: "p-2 hover:bg-blue-100 rounded-full transition-colors mb-4"
                }, React.createElement(ChevronUp, { className: "w-6 h-6 text-blue-600" })),
                
                React.createElement('div', {
                  className: "relative h-16 w-20 overflow-hidden"
                },
                  React.createElement('div', {
                    className: "flex flex-col items-center transition-transform duration-300 ease-in-out",
                    style: { 
                      transform: `translateY(${-options.indexOf(selectedValue) * 40 + 20}px)` 
                    }
                  },
                    options.map((option) =>
                      React.createElement('div', {
                        key: option,
                        className: `h-10 w-20 flex items-center justify-center text-3xl font-bold transition-all duration-300 ${
                          option === selectedValue 
                            ? 'text-blue-600 scale-125 bg-blue-50 rounded-lg border-2 border-blue-300' 
                            : 'text-gray-400 scale-75'
                        }`
                      }, option)
                    )
                  )
                ),
                
                React.createElement('button', {
                  onClick: () => handleScroll('down'),
                  className: "p-2 hover:bg-blue-100 rounded-full transition-colors mt-4"
                }, React.createElement(ChevronDown, { className: "w-6 h-6 text-blue-600" })),
                
                React.createElement('div', {
                  className: "flex space-x-4 mt-6"
                },
                  React.createElement('button', {
                    onClick: handleSelect,
                    className: "px-6 py-3 bg-blue-500 text-white rounded-lg text-lg font-medium hover:bg-blue-600 transition-colors"
                  }, "Select"),
                  React.createElement('button', {
                    onClick: onClose,
                    className: "px-6 py-3 bg-gray-300 text-gray-700 rounded-lg text-lg font-medium hover:bg-gray-400 transition-colors"
                  }, "Cancel")
                )
              )
            )
          );
        };

        const SchoolCycleCalendar = () => {
          const [currentMonth, setCurrentMonth] = useState(5);
          const [currentYear, setCurrentYear] = useState(2025);
          const [customCycleDays, setCustomCycleDays] = useState({});
          const [activeDropdown, setActiveDropdown] = useState(null);
          const [currentDate, setCurrentDate] = useState(new Date());

          // Philippine holidays for school year 2025-2026
          const philippineHolidays = [
            '2025-06-12', '2025-08-21', '2025-08-26', '2025-11-01', '2025-11-02',
            '2025-11-30', '2025-12-25', '2025-12-30', '2025-12-31', '2026-01-01',
            '2026-02-25', '2026-04-09', '2026-04-17', '2026-04-18', '2026-04-19'
          ];

          // Update current date every minute
          useEffect(() => {
            const updateCurrentDate = () => {
              setCurrentDate(new Date());
            };

            updateCurrentDate();
            const interval = setInterval(updateCurrentDate, 60000);
            return () => clearInterval(interval);
          }, []);

          const months = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];

          const cycleColors = [
            'bg-blue-200 border-blue-400 text-blue-900 shadow-blue-100',
            'bg-green-200 border-green-400 text-green-900 shadow-green-100',
            'bg-purple-200 border-purple-400 text-purple-900 shadow-purple-100',
            'bg-orange-200 border-orange-400 text-orange-900 shadow-orange-100',
            'bg-pink-200 border-pink-400 text-pink-900 shadow-pink-100',
            'bg-indigo-200 border-indigo-400 text-indigo-900 shadow-indigo-100',
            'bg-red-200 border-red-400 text-red-900 shadow-red-100',
          ];

          const today = currentDate;
          const todayString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

          const isWeekend = (date) => {
            const day = date.getDay();
            return day === 0 || day === 6;
          };

          const isPastDate = (date) => {
            const today = new Date(currentDate);
            today.setHours(23, 59, 59, 999);
            const compareDate = new Date(date);
            compareDate.setHours(23, 59, 59, 999);
            return compareDate < today;
          };

          const isHoliday = (dateString) => {
            return philippineHolidays.includes(dateString);
          };

          const isSchoolDay = (date) => {
            const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            return !isWeekend(date) && !isHoliday(dateString);
          };

          const handleCycleDayChange = (dateString, newCycleDay) => {
            const newCustomDays = { ...customCycleDays };
            
            if (newCycleDay === 0) {
              newCustomDays[dateString] = 0;
            } else {
              newCustomDays[dateString] = newCycleDay;
            }
            
            // Recalculate all subsequent days
            const targetDate = new Date(dateString);
            const allDates = [];
            
            const startDate = new Date(2025, 5, 1);
            const endDate = new Date(2026, 2, 31);
            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
              if (isSchoolDay(currentDate)) {
                const currentDateString = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;
                allDates.push({
                  date: new Date(currentDate),
                  dateString: currentDateString
                });
              }
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
            const changedIndex = allDates.findIndex(item => item.dateString === dateString);
            
            if (changedIndex !== -1) {
              for (let i = changedIndex + 1; i < allDates.length; i++) {
                const currentItem = allDates[i];
                
                let lastNonZeroDay = 0;
                for (let j = i - 1; j >= 0; j--) {
                  const checkItem = allDates[j];
                  let checkDay;
                  
                  if (newCustomDays.hasOwnProperty(checkItem.dateString)) {
                    checkDay = newCustomDays[checkItem.dateString];
                  } else if (customCycleDays.hasOwnProperty(checkItem.dateString)) {
                    checkDay = customCycleDays[checkItem.dateString];
                  } else {
                    const june18 = new Date(2025, 5, 18);
                    const checkDate = checkItem.date;
                    const compareDate = new Date(checkDate.getFullYear(), checkDate.getMonth(), checkDate.getDate());
                    const compareJune18 = new Date(2025, 5, 18);
                    
                    if (compareDate < compareJune18) {
                      checkDay = 0;
                    } else {
                      const schoolDaysSinceStart = getSchoolDaysSince(june18, checkDate);
                      checkDay = (schoolDaysSinceStart % 7) + 1;
                    }
                  }
                  
                  if (checkDay !== 0) {
                    lastNonZeroDay = checkDay;
                    break;
                  }
                }
                
                if (lastNonZeroDay === 0) {
                  newCustomDays[currentItem.dateString] = 1;
                } else {
                  newCustomDays[currentItem.dateString] = lastNonZeroDay === 7 ? 1 : lastNonZeroDay + 1;
                }
              }
            }
            
            setCustomCycleDays(newCustomDays);
            setActiveDropdown(null);
          };

          const getEffectiveCycleDay = (date) => {
            const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            
            if (customCycleDays.hasOwnProperty(dateString)) {
              return customCycleDays[dateString];
            }
            
            const june18 = new Date(2025, 5, 18);
            const compareDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const compareJune18 = new Date(2025, 5, 18);
            
            if (compareDate < compareJune18) {
              return 0;
            }
            
            const schoolDaysSinceStart = getSchoolDaysSince(june18, date);
            return (schoolDaysSinceStart % 7) + 1;
          };

          const getSchoolDaysSince = (startDate, endDate) => {
            let count = 0;
            let currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
              if (isSchoolDay(currentDate)) {
                count++;
              }
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return count - 1;
          };

          const getCycleNumber = (date) => {
            const cycleDay = getEffectiveCycleDay(date);
            
            if (cycleDay === 0) return 0;
            
            const june18 = new Date(2025, 5, 18);
            if (date < june18) return 0;
            
            const schoolDaysSinceStart = getSchoolDaysSince(june18, date);
            return Math.floor(schoolDaysSinceStart / 7) + 1;
          };

          const getTodaysCycleDay = () => {
            return getEffectiveCycleDay(currentDate);
          };

          const getTodaysCycle = () => {
            return getCycleNumber(currentDate);
          };

          const getDaysInMonth = (month, year) => {
            return new Date(year, month + 1, 0).getDate();
          };

          const getFirstDayOfMonth = (month, year) => {
            return new Date(year, month, 1).getDay();
          };

          const navigateMonth = (direction) => {
            if (direction === 'prev') {
              if (currentMonth === 0) {
                setCurrentMonth(11);
                setCurrentYear(currentYear - 1);
              } else {
                setCurrentMonth(currentMonth - 1);
              }
            } else {
              if (currentMonth === 11) {
                setCurrentMonth(0);
                setCurrentYear(currentYear + 1);
              } else {
                setCurrentMonth(currentMonth + 1);
              }
            }
            setActiveDropdown(null);
          };

          const renderCalendar = () => {
            const daysInMonth = getDaysInMonth(currentMonth, currentYear);
            const firstDay = getFirstDayOfMonth(currentMonth, currentYear);
            const days = [];

            for (let i = 0; i < firstDay; i++) {
              days.push(React.createElement('div', { key: `empty-${i}`, className: "h-16 sm:h-20" }));
            }

            for (let day = 1; day <= daysInMonth; day++) {
              const date = new Date(currentYear, currentMonth, day);
              const dateString = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
              const isToday = dateString === todayString;
              const isPast = isPastDate(date);
              const isSchoolDayFlag = isSchoolDay(date);
              const cycleDay = isSchoolDayFlag ? getEffectiveCycleDay(date) : null;
              const cycle = getCycleNumber(date);
              const isCurrentMonth = currentMonth >= 5 && (currentYear === 2025 || (currentYear === 2026 && currentMonth <= 2));
              const isDropdownActive = activeDropdown === dateString;

              let cellBgColor = '';
              if (isToday) {
                cellBgColor = 'bg-yellow-200 border-yellow-400 text-yellow-900 shadow-yellow-100';
              } else if (isSchoolDayFlag && cycleDay > 0 && cycle > 0 && !isPast) {
                const colorIndex = (cycle - 1) % cycleColors.length;
                cellBgColor = cycleColors[colorIndex];
              }

              days.push(
                React.createElement('div', {
                  key: day,
                  className: `h-16 sm:h-20 border border-gray-200 flex flex-col items-center justify-center text-sm sm:text-base relative transition-all duration-200 ${
                    isToday ? cellBgColor : 
                    isPast && isSchoolDayFlag ? 'bg-gray-100 text-gray-400 opacity-60' :
                    isSchoolDayFlag ? (cycleDay === 0 ? 'bg-gray-200' : cellBgColor) : 
                    isWeekend(date) ? 'bg-gray-100 text-gray-500' :
                    'bg-red-50 text-red-500'
                  } ${!isCurrentMonth ? 'opacity-50' : ''} hover:shadow-md ${
                    isToday ? 'ring-2 ring-yellow-500' : ''
                  }`
                },
                  React.createElement('span', { className: "font-medium mb-1" }, day),
                  isSchoolDayFlag && React.createElement('div', {
                    className: "flex flex-col items-center space-y-1 relative"
                  },
                    React.createElement('div', {
                      onClick: () => !isPast && setActiveDropdown(isDropdownActive ? null : dateString),
                      className: `text-xs font-bold px-2 py-1 rounded-full border-2 transition-all ${
                        isPast ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:shadow-md'
                      } ${
                        cycleDay === 0 ? 'bg-gray-400 text-white border-gray-500' :
                        isToday ? 'bg-yellow-400 text-white border-yellow-500 shadow-lg' : 
                        'bg-white border-current shadow-sm'
                      }`
                    }, cycleDay === 0 ? '0' : cycleDay)
                  ),
                  isHoliday(dateString) && !isWeekend(date) && React.createElement('div', {
                    className: "absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"
                  })
                )
              );
            }

            return days;
          };

          const formatTodayDate = () => {
            const options = { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            };
            return currentDate.toLocaleDateString('en-US', options);
          };

          return React.createElement('div', {
            className: "min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4"
          },
            React.createElement('div', {
              className: "max-w-4xl mx-auto"
            },
              // Header with test status
              React.createElement('div', {
                className: "bg-white rounded-2xl shadow-xl p-6 mb-6"
              },
                React.createElement('div', {
                  className: "flex items-center justify-between mb-4"
                },
                  React.createElement('div', {
                    className: "flex items-center space-x-2 px-3 py-1 rounded-full text-sm bg-green-100 text-green-700"
                  },
                    React.createElement(CheckCircle, { 
                      className: "w-4 h-4" 
                    }),
                    React.createElement('span', {}, "Calendar Working - Test Mode")
                  )
                ),
                React.createElement('div', {
                  className: "flex items-center justify-center"
                },
                  React.createElement('div', {
                    className: "text-center"
                  },
                    React.createElement('div', {
                      className: "flex items-center space-x-3 justify-center mb-2"
                    },
                      React.createElement(Calendar, { className: "w-8 h-8 text-blue-600" }),
                      React.createElement('h1', {
                        className: "text-2xl sm:text-3xl font-bold text-gray-800"
                      }, "School Cycle Calendar")
                    ),
                    React.createElement('div', {
                      className: "bg-blue-100 rounded-xl p-4 inline-block"
                    },
                      React.createElement('div', {
                        className: "text-3xl font-bold text-blue-800"
                      }, `TODAY IS DAY ${getTodaysCycleDay()}, CYCLE ${getTodaysCycle()}`),
                      React.createElement('div', {
                        className: "text-blue-600 font-medium mt-1"
                      }, formatTodayDate())
                    )
                  )
                )
              ),

              // Calendar
              React.createElement('div', {
                className: "bg-white rounded-2xl shadow-xl overflow-hidden"
              },
                // Month Navigation
                React.createElement('div', {
                  className: "bg-gradient-to-r from-blue-600 to-green-600 text-white p-4 flex items-center justify-between"
                },
                  React.createElement('button', {
                    onClick: () => navigateMonth('prev'),
                    className: "p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",
                    disabled: currentYear === 2025 && currentMonth === 5
                  }, React.createElement(ChevronLeft, { className: "w-5 h-5" })),
                  React.createElement('h2', {
                    className: "text-xl sm:text-2xl font-bold"
                  }, `${months[currentMonth]} ${currentYear}`),
                  React.createElement('button', {
                    onClick: () => navigateMonth('next'),
                    className: "p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",
                    disabled: currentYear === 2026 && currentMonth === 2
                  }, React.createElement(ChevronRight, { className: "w-5 h-5" }))
                ),

                // Days of Week Header
                React.createElement('div', {
                  className: "grid grid-cols-7 bg-gray-50"
                },
                  ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day) =>
                    React.createElement('div', {
                      key: day,
                      className: "p-3 text-center font-semibold text-gray-700 border-b border-gray-200"
                    }, day)
                  )
                ),

                // Calendar Grid
                React.createElement('div', {
                  className: "grid grid-cols-7"
                }, renderCalendar())
              ),

              // Modal
              React.createElement(SlotMachineModal, {
                value: activeDropdown ? (() => {
                  const [year, month, day] = activeDropdown.split('-');
                  const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                  return getEffectiveCycleDay(date) || 0;
                })() : 0,
                onChange: (newValue) => {
                  if (activeDropdown) {
                    handleCycleDayChange(activeDropdown, newValue);
                  }
                },
                onClose: () => setActiveDropdown(null),
                isVisible: !!activeDropdown
              }),

              // Legend
              React.createElement('div', {
                className: "bg-white rounded-2xl shadow-xl p-6 mt-6"
              },
                React.createElement('h3', {
                  className: "text-lg font-bold text-gray-800 mb-4"
                }, "Legend"),
                React.createElement('div', {
                  className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 text-sm mb-4"
                },
                  React.createElement('div', {
                    className: "flex items-center space-x-3"
                  },
                    React.createElement('div', {
                      className: "w-4 h-4 bg-yellow-200 border-2 border-yellow-400 rounded"
                    }),
                    React.createElement('span', {}, "Today")
                  ),
                  React.createElement('div', {
                    className: "flex items-center space-x-3"
                  },
                    React.createElement('div', {
                      className: "w-4 h-4 bg-gray-100 rounded opacity-60"
                    }),
                    React.createElement('span', {}, "Past Dates")
                  ),
                  React.createElement('div', {
                    className: "flex items-center space-x-3"
                  },
                    React.createElement('div', {
                      className: "w-4 h-4 bg-gray-200 rounded"
                    }),
                    React.createElement('span', {}, "Day 0 (No Cycle)")
                  ),
                  React.createElement('div', {
                    className: "flex items-center space-x-3"
                  },
                    React.createElement('div', {
                      className: "w-4 h-4 bg-gray-100 rounded"
                    }),
                    React.createElement('span', {}, "Weekends")
                  ),
                  React.createElement('div', {
                    className: "flex items-center space-x-3"
                  },
                    React.createElement('div', {
                      className: "w-4 h-4 bg-red-50 relative rounded"
                    },
                      React.createElement('div', {
                        className: "absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"
                      })
                    ),
                    React.createElement('span', {}, "Holidays")
                  )
                ),
                
                React.createElement('div', {
                  className: "mb-4"
                },
                  React.createElement('h4', {
                    className: "font-semibold text-gray-700 mb-2"
                  }, "Cycle Colors:"),
                  React.createElement('div', {
                    className: "grid grid-cols-7 gap-2 text-xs"
                  },
                    cycleColors.map((color, index) =>
                      React.createElement('div', {
                        key: index,
                        className: `p-2 rounded text-center font-medium ${color}`
                      }, `Cycle ${index + 1}`)
                    )
                  )
                ),
                
                React.createElement('div', {
                  className: "text-xs text-gray-600"
                },
                  React.createElement('p', {},
                    React.createElement('strong', {}, "TEST MODE: "),
                    "Changes work but don't sync between users or persist after refresh."
                  ),
                  React.createElement('p', {},
                    React.createElement('strong', {}, "Click any cycle number"),
                    " (future dates only) to adjust it. Changes will automatically update all following days."
                  ),
                  React.createElement('p', {},
                    React.createElement('strong', {}, "Past dates"),
                    " are greyed out and cannot be modified."
                  ),
                  React.createElement('p', {},
                    React.createElement('strong', {}, "Day 0:"),
                    " Non-cycle school days. Next school day after Day 0 becomes Day 1."
                  ),
                  React.createElement('p', {},
                    React.createElement('strong', {}, "Default:"),
                    " First cycle begins Wednesday, June 18, 2025. Days before are Day 0."
                  )
                )
              )
            )
          );
        };

        ReactDOM.render(React.createElement(SchoolCycleCalendar), document.getElementById('root'));
    </script>
</body>
</html>
